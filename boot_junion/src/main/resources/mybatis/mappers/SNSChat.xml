<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.DAO.SNSChatDAO">
    
    <select id="selectAllRooms" resultType="com.boot.DTO.SNSRoom">
		SELECT distinct
			chatRoom_id,
		    CASE 
		        WHEN sender_id = #{senderId} THEN receiver_id
		        ELSE sender_id
		    END AS other_id
		FROM chat_tb
		WHERE sender_id = #{senderId} OR receiver_id = #{senderId};
    </select>
    
    <select id="checkRooms" resultType="int">
        SELECT count(*) 
        FROM chatRoom_tb
        WHERE (sender_id = #{senderId} AND receiver_id = #{receiverId})
   		   OR (sender_id = #{receiverId} AND receiver_id = #{senderId})
    </select>
    
    <select id="getRooms" resultType="int">
        SELECT chatRoom_id
        FROM chatRoom_tb
        WHERE (sender_id = #{senderId} AND receiver_id = #{receiverId})
   		   OR (sender_id = #{receiverId} AND receiver_id = #{senderId})
    </select>

    <insert id="insertRoom" parameterType="com.boot.DTO.SNSRoom">
        INSERT INTO chatRoom_tb (sender_id, receiver_id) VALUES (#{senderId}, #{receiverId})
    </insert>
    

    <select id="selectMessagesByRoomId" parameterType="int" resultType="com.boot.DTO.SNSChat">
        SELECT * FROM chat_tb WHERE chatRoom_id = #{roomId} ORDER BY timestamp
    </select>

    <insert id="insertMessage" parameterType="com.boot.DTO.SNSChat">
        INSERT INTO chat_tb (sender_id, receiver_id, chatRoom_id, message, timestamp)
        VALUES (#{sender_id}, #{receiver_id}, #{chatRoom_id}, #{message}, #{timestamp})
    </insert>
    
</mapper>










